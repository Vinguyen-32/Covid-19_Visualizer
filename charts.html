<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body>
    <div>
        <canvas id="pieChart"></canvas>
        <canvas id="pieChart1"></canvas>
        <canvas id="pieChart2"></canvas>
    </div>
    <script>
        function generateColor() {
            var r = Math.floor(Math.random() * 255);
            var g = Math.floor(Math.random() * 255);
            var b = Math.floor(Math.random() * 255);
            return "rgb(" + r + "," + g + "," + b + ")";
        }
        function renderAgeChart() {
            $.ajax({
                url: "http://34.216.18.166:3000/data/age",
                success: function (rawData) {
                    // Transform data
                    let d = [];
                    let labels = [];

                    Object.keys(rawData).map(function (key) {
                        d.push(rawData[key]);
                        labels.push(key);
                    })
                    let data = {
                        datasets: [{
                            data: d,
                            backgroundColor: d.map(function (item) {
                                return generateColor();
                            })
                        }],
                        labels: labels,
                    };

                    var ctx = document.getElementById('pieChart');

                    var myPieChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: data,
                        options: {}
                    });
                }
            });
        }

        function renderGenderChart() {
            $.ajax({
                url: "http://34.216.18.166:3000/data/gender",
                success: function (rawData) {
                    // Transform data
                    let d = [];
                    let labels = [];

                    Object.keys(rawData).map(function (key) {
                        d.push(rawData[key]);
                        labels.push(key);
                    })

                    let data = {
                        datasets: [{
                            data: d,
                            backgroundColor:  d.map(function (item) {
                                return generateColor();
                            })
                        }],
                        labels: labels,
                    };

                    var ctx = document.getElementById('pieChart1');

                    var pieChart1 = new Chart(ctx, {
                        type: 'doughnut',
                        data: data,
                        options: {}
                    });
                }
            });
        }

        function renderRaceChart() {
            $.ajax({
                url: "http://34.216.18.166:3000/data/race",
                success: function (rawData) {
                    // Transform data
                    let d = [];
                    let labels = [];

                    Object.keys(rawData).map(function (key) {
                        d.push(rawData[key]);
                        labels.push(key);
                    })

                    let data = {
                        datasets: [{
                            data: d,
                            backgroundColor:  d.map(function (item) {
                                return generateColor();
                            })
                        }],
                        labels: labels,
                    };

                    var ctx = document.getElementById('pieChart2');

                    var pieChart2 = new Chart(ctx, {
                        type: 'doughnut',
                        data: data,
                        options: {}
                    });
                }
            });
        }

        renderAgeChart();
        renderGenderChart();
        renderRaceChart();

    </script>
</body>

</html>
